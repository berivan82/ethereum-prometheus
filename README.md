# ethereum-prometheus
An ethereum-node, prometheus and grafana bundle set.

Для работы собираемой системы необходимы установленные пакеты docker-ce, docker-compose и jq. Последний автоматически установится на deb-based системе.
Репозиторий содержит скрипты и конфиги для разворачивания связки ethereum-клиента(geth), который загружает данные из сети, которые затем pull`ит в свою базу Prometheus, откуда в свою очередь их подхватывает Grafana и использует для визуализации состояний ethereum-ноды.

Для установки заходим в репозиторий и запускаем скрипт start-ethereum.sh. Он попросит ввести имя сетевого интерфейса, на который будут проброшены разворачиваемыемые с помощью docker-compose в docker-контейнерах сервисы. По имени интерфейса определяется его ip-адрес и прописывается в конфиге с job`ами Prometheus`а, а также вписывается в файл, читаемый отдельным скриптом, который импортирует в Gafana`у настройки Prometheus data source и dashboard`ов. Также скрипт включает ip-форвардинг, создат volumes`ы для хранения данных контейнеров, чтобы они не терялись в случае их(контейнеров) перезапуска.

Далее запускается docker-compose, который собирает geth-ноду на основе Alpine Linux, устанавливая необходимые для сборки пакеты; затем docker-compose включает трансляция geth-метрик на порт 6060. Поcле скачивается image Prometheus`а, и в него монтируется настроенный ранее конфиг. Последней запускается Grafana. По завершении docker-compose продолжает работать в фоновом режиме.

Для настройки Grafana`ы используется отдельный скрипт из папки grafana, который, соответственно надо запустить. Он настроит datasource и dashboard. Всё - можно заходить в Grafana на порт 3000 и смотреть dashboard.

Примечание: я не нашел среди geth-метрик 4-ой из задания. Также можно автоматизирвать установку jq(но тогда, почему бы и docker сюда приписать?) на другие ОС и включить скрипт, настраивающий Grafana, - в основной - но здесь я вижу единственную проблему с правильной задержкой sleep после docker-compose up, чтобы не промахнуться в недозагрузившийся сервер, хотя можно и цикл с if написать. Здесь я не стал экспериментировать, т.к. время поджимает.

На этом все. Надеюсь на благосклонность.)
