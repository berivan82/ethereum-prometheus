# ethereum-prometheus
An ethereum-node, prometheus and grafana bundle set.

Репозиторий сщдержит скрипты и настройки для разворачивания связки ethereum-клиента(geth), который загружает данные из сети, которые затем pull`ит в свою базу Prometheus, откуда в свою очередь их подхватывает Grafana и использует для визуализации состояний ethereum ноды.
Для установки заходим в репозиторий и запускаем скрипт start-ethereum.sh. Он попросит ввести имя сетевого интерфейса, на который будут проброшены разворачиваемыемые с помощью docker-compose в docker-контейнерах сервисы. По имени интерфейса определяется его ip-адрес и прописывается в конфиге с job`ами Prometheus`а, а также вписывается в файл, читаемый отдельным скриптом, который импортирует в Gafana`у настройки Prometheus data source и dashboard`ов. Также разрешается ip-форвардинг. создаются volumes`ы для хранения данных контейнеров, чтобы они не терялись в случае их перезапуска.
Далее запускается docker-compose, который собирает geth-ноду на основе Alpine Linux, устанавливая необходимые для сборки пакеты и включается трансляция метрик на порт 6060. Потом скачивает image Prometheus`а и в него монтируется настроенный ранее конфиг. Последней запускается Grafana.
По завершении docker-compose продолжает работать в фоновом режиме. Для настройки Grafana`ы используется отдельный скрипт из папки grafana, который, соответственно надо запустить. Он настроит datasource и dashboard. Для правильной отработки скррипта необходимо иметь установленный пакет jq. Он автоматически установится в случае запуска на deb-based системе. В rpm-based нужно установить вручную наряду с docker-ce и docker-compose.
